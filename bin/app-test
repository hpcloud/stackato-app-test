#!/bin/bash

set -e

source "${BASH_SOURCE%/*}/setup.bash"

main() {
  name=${1:?'First argument is app name'}

  cd "${BASH_SOURCE%/*}/.."

  mkdir -p log
  logfile="$PWD/log/$name.log"

  read-conf

  (
    cd "$apps_directory/$name"

    echo
    echo "=== Testing 'stackato push -n' for '$name'"
    echo

    stackato push -n 2>&1 | tee "$logfile"

    # Todo:
    # - grep for 'http://ace.stackato.east.ouistreet.net/ deployed'
    # - HEAD $URL for 200
    # - Delete the app after it checks out (maybe with --delete option)
  )
}

[ "$BASH_SOURCE" == "$0" ] && main "$@"

# vim: set lisp:
